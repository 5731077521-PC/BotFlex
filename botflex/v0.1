Ported to input framework
Introduced weights
Condition 4
Removed redundant state maintenance, effectively aiming for consistent memory usage
